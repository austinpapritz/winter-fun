<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- metadata -->
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />

        <!-- title and favicon -->
        <title>Web App</title>

        <!-- js -->
        <script type="module" src="app.js"></script>

        <!-- fonts -->
        <!-- see https://fonts.google.com/ -->

        <!-- css -->
        <link rel="stylesheet" href="styles/reset.css" />
        <link rel="stylesheet" href="styles/global.css" />
        <!-- add link for page specific css -->
        <script>
            let calcArr = [];

            //BUG: can use multiple operators in a row
            //BUG: user can start with operator
            //BUG: should not be able to press '=' until an operator has been pressed
            //BUG: should be able to operate on result of previous evaluation

            function tossIfFirstNotNum(n) {
                if ((n === '/' || n === '-' || n === '+' || n === '*') && calcArr.length === 0) {
                    return;
                } else {
                    return n;
                }
            }

            function compareNAndLastItem(n) {
                //BUGGED:if I leave this in, it doesn't replace, if I comment out it replaces when last, and after a num has been pressed
                if (n === '/' || n === '-' || n === '+' || n === '*') {
                    let lastItem = calcArr[calcArr.length - 2];

                    if (
                        lastItem === '/' ||
                        lastItem === '-' ||
                        lastItem === '+' ||
                        lastItem === '*'
                    ) {
                        replaceLast(n);
                    } else {
                        return n;
                    }
                }
                return n;
            }

            function replaceLast(newOperator) {
                calcArr[calcArr.length - 2] = newOperator;
            }

            function ifFirstOperatorOrNumPush(n) {
                if (n === '/' || n === '-' || n === '+' || n === '*') {
                    //if first operator push to calcArr with spaces
                    calcArr.push(' ');
                    calcArr.push(n);
                    calcArr.push(' ');
                } else {
                    //if number push to calcArr
                    calcArr.push(n);
                }
            }

            function displayCalcArr() {
                //display the calcArr (with a space between values) and the current squished number in results
                document.getElementById('result').value = calcArr.join('');
            }

            function handleInput(n) {
                //if first input is an operator then toss, otherwise return n
                let o = tossIfFirstNotNum(n);
                console.log('o', o);
                //if both o and last item are operators then replace lastItem with n, otherwise return n
                let p = compareNAndLastItem(o);
                console.log('p', p);
                //at this point p could be a number or first-time operator
                ifFirstOperatorOrNumPush(p);
                //at this point q is a number
                displayCalcArr();
            }

            function clearScreen() {
                calcArr = [];
                document.getElementById('result').value = '';
            }

            function calculate() {
                //set results to the evaluation of equation
                const results = calcArr.join('');
                document.getElementById('result').value = eval(results);
                //the follow replaces the previous calcArr with the answer of results so user can perform math on it
                calcArr = [];
                let newEquation = document.getElementById('result').value;
                calcArr.push(newEquation);
                displayCalcArr();
            }
        </script>
    </head>

    <body>
        <header>
            <h1>❄️Winter Fun❄️</h1>
        </header>

        <main>
            <p id="display-fib"></p>
            <p id="display-iter"></p>

            <table class="calculator">
                <tr>
                    <td colspan="3">
                        <input class="display-box" type="text" id="result" disabled />
                    </td>

                    <!-- clearScreen() function clears all the values -->

                    <td>
                        <input type="button" value="C" onclick="clearScreen()" id="clear-btn" />
                    </td>
                </tr>
                <tr>
                    <!-- displayCalc() function displays the value of clicked button -->

                    <td><input type="button" value="1" onclick="handleInput('1')" /></td>

                    <td><input type="button" value="2" onclick="handleInput('2')" /></td>

                    <td><input type="button" value="3" onclick="handleInput('3')" /></td>

                    <td><input type="button" value="/" onclick="handleInput('/')" /></td>
                </tr>
                <tr>
                    <td><input type="button" value="4" onclick="handleInput('4')" /></td>

                    <td><input type="button" value="5" onclick="handleInput('5')" /></td>

                    <td><input type="button" value="6" onclick="handleInput('6')" /></td>

                    <td><input type="button" value="-" onclick="handleInput('-')" /></td>
                </tr>
                <tr>
                    <td><input type="button" value="7" onclick="handleInput('7')" /></td>

                    <td><input type="button" value="8" onclick="handleInput('8')" /></td>

                    <td><input type="button" value="9" onclick="handleInput('9')" /></td>

                    <td><input type="button" value="+" onclick="handleInput('+')" /></td>
                </tr>
                <tr>
                    <td><input type="button" value="." onclick="handleInput('.')" /></td>

                    <td><input type="button" value="0" onclick="handleInput('0')" /></td>

                    <!-- calculate() function evaluates the mathematical expression -->

                    <td>
                        <input type="button" value="=" onclick="calculate()" id="equal-btn" />
                    </td>

                    <td><input type="button" value="*" onclick="handleInput('*')" /></td>
                </tr>
            </table>
        </main>
    </body>
</html>
